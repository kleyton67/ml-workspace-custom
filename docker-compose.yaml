services:
  ml-workspace:
    image: kleyton67/ml-workspace:0.u2404.n12.8$TAG
    build:
      dockerfile: ./Dockerfile.128
      context: .
    container_name: ml-workspace-test
    ports:
      - "8588:8080"
      - "8589:6901"
    volumes:
      # - /mnt/ssds/SSD_1/mltooling/jupyter-data:/root/workspace
      # - /mnt/data/mltooling-hd:/root/workspace-hd
      # - /mnt/ssds/SSD_1/mltooling/conda:/opt/conda/conda
      - /var/run/docker.sock:/var/run/docker.sock
      - ./logs:/var/log/supervisor/
      - /etc/localtime:/etc/localtime:ro
    deploy:       # ‚Üê Modern Docker GPU reservation
      resources:
        limits:
          # CPU: Maximum number of CPUs (e.g., 2.5)
          cpus: '6'
          # Memory: Maximum memory (e.g., 512MB or 512000000 bytes)
          memory: 16G
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    environment:
      - AUTHENTICATE_VIA_JUPYTER=key123
      - VNC_PW=key123
    shm_size: 512m
    restart: always
    network_mode: bridge
